{% extends "base.html" %}

{% block title %}Feedback - Cyber Phishing Detection{% endblock %}

{% block content %}
<div class="feedback-container">
    <h1 class="feedback-title">Feedback Form</h1>
    <form id="feedback-form" method="POST" action="{{ url_for('feedback') }}">
        <div class="form-group">
            <select name="feedback_type" required>
                <option value="" disabled selected>Select Feedback Type</option>
                <option value="bug_report">Bug Report</option>
                <option value="feature_request">Feature Request</option>
                <option value="general_feedback">General Feedback</option>
            </select>
        </div>
        <div class="form-group">
            <input type="text" name="subject" placeholder="Enter URL, Domain, IP, or Hash" required>
        </div>
        <div class="form-group">
            <textarea name="message" placeholder="Your message here..." required></textarea>
        </div>
        <button type="submit" class="submit-btn">Submit Feedback</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.getElementById('feedback-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Get the submit button
        const submitButton = document.getElementById('submitButton');
        
        // If the button is already disabled, return early
        if (submitButton.disabled) {
            return;
        }
        
        // Disable the submit button
        submitButton.disabled = true;
        submitButton.textContent = 'Submitting...';

        try {
            const formData = new FormData(this);
            const response = await fetch('/submit_feedback', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                alert('Feedback submitted successfully!');
                this.reset();
            } else {
                alert(data.message || 'Error submitting feedback. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        } finally {
            // Re-enable the submit button
            submitButton.disabled = false;
            submitButton.textContent = 'Submit Feedback';
        }
    });
</script>
{% endblock %}